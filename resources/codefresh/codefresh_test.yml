version: '1.0'

steps:

  git_clone_private_repo:
    title: Building Test Image
    description: Build Test Image desc...
    image: bbaldassari/image_base_centos:latest
    working_directory: /home/alambic/
    commands:
      - git clone https://bitbucket.org/BorisBaldassari/alambic.git /home/alambic/alambic
      - su - alambic -c 'cd /home/alambic/alambic && git checkout {branch_name} && git branch && git status'
      - su - alambic -c 'cp /home/alambic/alambic/docker/image_test/alambic.conf /home/alambic/alambic/mojo/'

  push_ci_to_registry:
    title: Pushing to Docker Registry
    description: Pushing CI Image desc...
    type: push

    # A candidate is the image that we want to push to registry
    candidate: '${{build_ci_image}}'

    # You can push the image with whatever tag you want. In our example we use CF_BRANCH, which is a variable in
    # the build process, accessible throughout the entire flow.
    tag: latest # '${{CF_BRANCH}}'

