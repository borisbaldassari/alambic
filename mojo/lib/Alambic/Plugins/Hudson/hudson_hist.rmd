---
output: html_document
---

```{r init, echo=FALSE, message=FALSE, results='asis'}

library(xts)
library(dygraphs)

project.id <- 'modeling.sirius'
file.builds = paste("", project.id, "_hudson_builds.csv", sep="")
builds <- read.csv(file=file.builds, header=T)
builds$date <- as.POSIXct(builds$time / 1000, origin="1970-01-01")
builds$day <- as.Date(as.POSIXlt(builds$time / 1000, origin="1970-01-01"))
builds$duration <- builds$duration / 1000 / 60

evol.xts <- xts(builds, order.by = builds$day)

t.ok <- as.data.frame(table(evol.xts[evol.xts$result == 'SUCCESS',c('day')]))
t.unstable <- as.data.frame(table(evol.xts[evol.xts$result == 'UNSTABLE',c('day')]))
t.failed <- as.data.frame(table(evol.xts[evol.xts$result == 'FAILURE',c('day')]))

t <- merge(t.ok, t.unstable, by = 'Var1')
t <- merge(t, t.failed, by = 'Var1')
names(t) <- c('date', 'ok', 'unstable', 'failed')

t.xts <- xts(t, order.by = as.POSIXlt(t$date))

p <-dygraph( 
        data = t.xts,
        main = paste('CI builds for ', project.id, sep=''),
        width = 800, height = 250 ) %>% 
      dyAxis("x", drawGrid = FALSE) %>%
      dySeries("ok", label = "Successful builds") %>%
      dySeries("failed", label = "Failed builds") %>%
      dySeries("unstable", label = "Unstable builds") %>%
#      dyOptions(colors = RColorBrewer::brewer.pal(3, "Set1")) %>%
      dyRangeSelector()
p
```

