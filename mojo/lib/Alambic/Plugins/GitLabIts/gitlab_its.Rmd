---
title: "GitLab ITS visualisation"
author:
- name: "Boris Baldassari"
  affiliation: Castalia Solutions
output:
  html_fragment:
    toc: false
    fig_caption: true
    fig.width: 800
    self_contained: false
    lib_dir: libs
    echo: false
    dev: svg
---

```{r init, echo=FALSE, message=FALSE}
library(knitr)
library(xts)
library(reshape2)
require(ggplot2)
require(xtable)

knitr::opts_chunk$set(fig.path = "figures/")

# Plugin needs the following parameters:
#   * project.id
#   * gitlab.id
#   * gitlab.url

project.id <- 'alambic'
gitlab.id <- 'bbaldassari/Alambic'
gitlab.url <- 'https://gitlab.com'
plugin.id <- 'GitLabIts'
file.metrics = paste("", project.id, "_ci_metrics.csv", sep="")
file.builds = paste("", project.id, "_ci_jobs.csv", sep="")
file.pipes = paste("", project.id, "_ci_pipelines.csv", sep="")

metrics <- read.csv(file=file.metrics, header=T)
builds <- read.csv(file=file.builds, header=T)
pipes <- read.csv(file=file.pipes, header=T)

```

## GitLab Continuous Integration

<br />

<div class="row"><div class="col-sm-7">

GitLab offers Continuous Integration services through [Builds and Pipelines](https://docs.gitlab.com/ee/ci/pipelines.html). This plugin retrieves information about all builds and pipelines for the specified project, and computes metrics and recommendations. GitLab offers a [complete API](https://docs.gitlab.com/ee/api/README.html) to interact with a GitLab server, and Perl has a ready-to-use [module that cover the API&apos;s features](http://search.cpan.org/~bluefeet/GitLab-API-v3-0.08/lib/GitLab/API/v3.pm).

Data for project is directly available from the project&apos;s dashboard:

* project summary: `r gitlab.url`/`r gitlab.id`
* project pipelines: `r gitlab.url`/`r gitlab.id`/pipelines
* project builds: `r gitlab.url`/`r gitlab.id`/builds

</div><div class="col-sm-4">
  <div class="panel panel-default">
  <div class="panel-heading"><h3 class="panel-title">Contents</h3></div>
  <div class="list-group">
  <a href="#summary" class="list-group-item">Quick Summary</a>
  <a href="#builds" class="list-group-item">List of builds</a>
  <a href="#pipelines" class="list-group-item">List of pipelines</a>
  </div>
  </div>
</div></div>

### <a name="quick-summary"></a>Quick Summary

There is a total of `r ncol(metrics)` metrics retrieved:

```{r metrics_table, echo=FALSE, message=FALSE, results='asis'}
t <- lapply(names(metrics), function(x) paste(x, ' <span class="badge">', metrics[[x]], '</span>, ', sep=''))
t <- paste(t, collapse=" ")
cat(t)
```

There are ``r ncol(builds)`` metrics related to builds, for a total of ``r nrow(builds)`` builds. There are ``r ncol(pipes)`` metrics related to pipelines for a total of ``r nrow(pipes)`` pipelines.

The following plot uses [plotly services](http://plot.ly) to enable users to play with data itself, and its associated plot. Hover on the graph for more options.

<iframe src="/projects/`r project.id`/EclipseIts/its_evol_summary.html" frameborder="0" style="width: 100%; height: 370px"></iframe>

-----

## <a name="builds"></a>Builds


<div class="panel panel-default">
<div class="panel-heading" style="background-color: #3E3F3A; color: white"><span class="fa fa-indent"></span>  Builds</div>

<table class="table table-striped">
  <tr><th>ID</th><th>Status</th><th>Ref branch</th><th>Commit</th></tr>
```{r builds_table, echo=FALSE, message=FALSE, results='asis'}
t <- apply(builds, 1, 
		   function(x) paste(' <tr><td>', x[[1]], '</td><td>', x[[2]], '</td><td>', 
							    x[[3]], '</td><td>', x[[7]], '</td></tr>', sep=''))
t <- paste(t, collapse=" ")
cat(t)
```
</table>
</div>
</div></div>

-----

### <a name="pipelines"></a>Pipelines

Please note that pipelines are currently infered from builds, which means that only pipelines associated with existing builds are listed.

<div class="panel panel-default">
<div class="panel-heading" style="background-color: #3E3F3A; color: white"><span class="fa fa-indent"></span>  Pipelines</div>

<table class="table table-striped">
  <tr><th>ID</th><th>SHA</th><th>Status</th><th>Ref branch</th><th>Builds</th></tr>
```{r pipelines_table, echo=FALSE, message=FALSE, results='asis'}
t <- apply(pipes, 1, 
		   function(x) paste(' <tr><td>', x[[1]], '</td><td>', x[[2]], '</td><td>', 
							 x[[4]], '</td><td>', x[[3]], '</td><td>', x[[5]], 
							 '</td></tr>', sep=''))
t <- paste(t, collapse=" ")
cat(t)
```
</table>
</div>
</div></div>

-----

### <a name="downloads"></a>Downloads

The visualisations on this page can be exported and easily reused on an external web site. You can find more information on iframes and pictures reuse in [the project&apos;s wiki](https://bitbucket.org/BorisBaldassari/alambic/wiki/Using_autogenerated_pictures/). Remember to change the server name in the code samples provided.

Plot of main evolution metrics of the issue tracking system

    <iframe src="http://server/projects/`r project.id`/EclipseIts/its_evol_summary.html" frameborder="0" style="width: 100%; height: 370px"></iframe>

Evolution of updates on issues

    <iframe src="http://server/projects/`r project.id`/EclipseIts/its_evol_changed.html" frameborder="0" style="width: 100%; height: 300px"></iframe>

Evolution of people involved in the issue tracking system

    <iframe src="http://server/projects/`r project.id`/EclipseIts/its_evol_people.html" frameborder="0" style="width: 100%; height: 300px"></iframe>
    
Evolution of opened and closed issues

    <iframe src="http://server/projects/`r project.id`/EclipseIts/its_evol_opened.html" frameborder="0" style="width: 100%; height: 300px"></iframe>

The visualisations used in this document rely on a number of flat CSV and JSON data files. You can download and play with them if you want to thereafter:

* List of raw static metrics retrieved from the eclipse dashboard [ <a href="import_its.json">Download JSON</a> ]
* List of computed static metrics for ITS [ <a href="metrics_its.csv">Download CSV</a> | <a href="metrics_its.json">Download JSON</a> ]
* List of evolution metrics for ITS [ <a href="metrics_evol_its.csv">Download CSV</a> | <a href="metrics_evol_its.json">Download JSON</a> ]


